# ZAP MCP Server - 模組化版本
FROM python:3.10-slim

# 安裝系統依賴
RUN apt-get update && apt-get install -y curl nmap && rm -rf /var/lib/apt/lists/* \
    && curl -fsSL https://download.docker.com/linux/static/stable/x86_64/docker-24.0.5.tgz -o docker.tgz \
    && tar xzvf docker.tgz \
    && mv docker/docker /usr/local/bin/ \
    && rm -rf docker docker.tgz

WORKDIR /app

# 安裝 Python 依賴
RUN pip install --no-cache-dir mcp[cli] Fastmcp requests beautifulsoup4

# 複製模組化程式碼
COPY core/ ./core/
COPY validators/ ./validators/
COPY docker_utils/ ./docker_utils/
COPY tools/ ./tools/
COPY server.py .

# 建立掛載點
RUN mkdir -p /app/data /output

# 設定 PYTHONPATH
ENV PYTHONPATH=/app

CMD ["python", "server.py"]
