# 使用 Python 基礎映像檔
FROM python:3.10-slim

# [Optimization] 需求3: 不安裝 apt 的 docker.io，改用 curl 下載靜態 binary
# 這會大幅減少映像檔體積
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/* \
    && curl -fsSL https://download.docker.com/linux/static/stable/x86_64/docker-24.0.5.tgz -o docker.tgz \
    && tar xzvf docker.tgz \
    && mv docker/docker /usr/local/bin/ \
    && rm -rf docker docker.tgz

# 設定工作目錄
WORKDIR /app

# 安裝 MCP 依賴
# 使用 --no-cache-dir 減少 pip 快取體積
RUN pip install --no-cache-dir mcp[cli] Fastmcp

# 複製 MCP 腳本
COPY zap_mcp_server.py .

# 建立掛載點
RUN mkdir -p /app/data /output

# 啟動指令
CMD ["python", "zap_mcp_server.py"]